<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OTP Login via SMS</title>
</head>
<body>
    <h2>Login with OTP (SMS)</h2>

    <div>
        <label for="phone">Phone Number:</label>
        <input type="text" id="phone" placeholder="e.g. 9876543210" />
        <button onclick="sendOTP()">Send OTP</button>
    </div>

    <div style="margin-top: 20px;">
        <label for="otp">Enter OTP:</label>
        <input type="text" id="otp" placeholder="Enter OTP" />
        <button onclick="verifyOTP()">Verify OTP</button>
    </div>

    <p id="response" style="color: green;"></p>

    <script>
        async function sendOTP() {
            const phone = document.getElementById("phone").value.trim();
            const responseEl = document.getElementById("response");
            responseEl.style.color = "green";

            if (!phone || !/^\d{10}$/.test(phone)) {
                responseEl.style.color = "red";
                responseEl.innerText = "Please enter a valid 10-digit phone number.";
                return;
            }

            try {
                const res = await fetch('http://localhost:5000/send-otp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone })
                });

                const data = await res.json();
                responseEl.innerText = data.message || data.error || "Unexpected response.";
                if (data.error) responseEl.style.color = "red";

            } catch (error) {
                responseEl.style.color = "red";
                responseEl.innerText = "Failed to send OTP. Server might be down.";
            }
        }

        async function verifyOTP() {
            const phone = document.getElementById("phone").value.trim();
            const otp = document.getElementById("otp").value.trim();
            const responseEl = document.getElementById("response");
            responseEl.style.color = "green";

            if (!otp || !/^\d{4,6}$/.test(otp)) {
                responseEl.style.color = "red";
                responseEl.innerText = "Please enter a valid OTP.";
                return;
            }

            try {
                const res = await fetch('http://localhost:5000/verify-otp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone, otp })
                });

                const data = await res.json();
                responseEl.innerText = data.message || data.error || "Unexpected response.";
                if (data.error) responseEl.style.color = "red";

            } catch (error) {
                responseEl.style.color = "red";
                responseEl.innerText = "Failed to verify OTP. Server might be down.";
            }
        }
    </script>
</body>
</html>
